<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APP Centenário</title>
    <!-- Inclui a biblioteca Tailwind CSS para estilização rápida e responsiva -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Configura a fonte "Roboto" para uma leitura clara e moderna-->
    <style>
        body {
            font-family: 'Roboto', sans-serif;
        }
        /* Estilos personalizados para o carrossel horizontal */
        .horizontal-scroll-container {
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none; /* Firefox */
        }
        .horizontal-scroll-container::-webkit-scrollbar {
            display: none; /* Chrome, Safari, Opera */
        }
        /* Animação para o ícone de rotação */
        @keyframes rotatePhone {
            0% { transform: rotate(0deg); }
            25% { transform: rotate(15deg); }
            50% { transform: rotate(0deg); }
            75% { transform: rotate(-15deg); }
            100% { transform: rotate(0deg); }
        }
        .animate-rotate {
            animation: rotatePhone 2s infinite;
        }

        /* Estilos para as alças de redimensionamento */
        .mini-player-handle {
            cursor: grab;
            touch-action: none;
        }

        /* Classes para o mini-player */
        .mini-player-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 320px;
            height: 180px;
            transition: all 0.3s ease-in-out;
            z-index: 50;
        }

        /* Estilos para o menu de filtro flutuante */
        .floating-header-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 50;
            transition: transform 0.3s ease-in-out;
        }
        .floating-header-container.hidden-header {
            transform: translateY(-100%);
        }

        /* Estilo para garantir que o iframe do YouTube se adapte */
        .video-container {
            position: relative;
            width: 100%;
            height: 0;
            padding-top: 56.25%; /* Proporção 16:9 */
        }

        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen flex flex-col">

    <!-- Cabeçalho e filtros flutuantes -->
    <div id="floatingHeaderContainer" class="floating-header-container">
        <!-- Cabeçalho fixo com o título e campo de pesquisa -->
        <header class="bg-gray-800 p-4 sm:p-6 flex flex-row items-center justify-between rounded-b-xl shadow-lg">
            <div class="flex items-center space-x-4">
                <h1 class="text-3xl sm:text-2xl font-bold">APP Centenário</h1>
            </div>
            <div class="relative w-full sm:w-64">
                <input type="text" id="searchInput" placeholder="Pesquisar vídeos..." class="w-full pl-10 pr-4 py-2 bg-gray-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-red-600 focus:border-transparent text-sm">
                <svg class="w-5 h-5 text-gray-400 absolute left-3 top-1/2 transform -translate-y-1/2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd"></path>
                </svg>
            </div>
        </header>

        <!-- Menu de filtro flutuante -->
        <div id="filterMenu" class="bg-gray-900 py-3 rounded-b-lg shadow-md flex justify-center flex-col">
            <div id="categoryButtonsContainer" class="horizontal-scroll-container flex flex-nowrap space-x-3 px-4 pb-2 overflow-x-auto">
                <!-- Botões de categoria serão criados dinamicamente aqui -->
            </div>
            <div class="flex justify-start px-4 mt-2 space-x-3">
                <button id="surpriseMeBtn" class="flex-none px-4 py-2 bg-blue-600 hover:bg-blue-700 transition-colors text-sm rounded-full shadow-lg">
                    Surpreenda-se
                </button>
                <button id="unwatchedBtn" class="flex-none px-4 py-2 bg-purple-600 hover:bg-purple-700 transition-colors text-sm rounded-full shadow-lg">
                    Não assistidos
                </button>
            </div>
        </div>
    </div>

    <!-- Modal para exibir o vídeo -->
    <div id="videoModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center p-4 z-50 transition-opacity duration-300 ease-in-out">
        <div class="bg-gray-900 rounded-lg shadow-xl p-6 relative w-full max-w-4xl max-h-full flex flex-col items-center">
            <h2 id="videoTitle" class="text-xl sm:text-2xl font-semibold leading-tight text-center mb-4"></h2>
            <div id="videoContainer" class="video-container w-full">
                <!-- O vídeo do YouTube será inserido aqui -->
            </div>
            <div class="flex flex-wrap justify-center sm:justify-start space-x-2 sm:space-x-4 mt-4 w-full">
                <button id="minimizeModalBtn" class="flex items-center px-4 py-2 bg-gray-700 hover:bg-gray-600 transition-colors rounded-full text-sm">
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"></path></svg>
                    Minimizar
                </button>
                <button id="closeModalBtn" class="flex items-center px-4 py-2 bg-red-500 hover:bg-red-700 transition-colors text-white text-sm rounded-full">
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                    Fechar
                </button>
                <button id="shareVideoBtn" class="flex items-center px-4 py-2 bg-blue-500 hover:bg-blue-700 transition-colors text-white text-sm rounded-full">
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684a3 3 0 100-2.684m0-1.342a3 3 0 100 2.684m8.684 1.342c.202.404.316.86.316 1.342s-.114.938-.316 1.342m0-2.684a3 3 0 110 2.684m0-2.684a3 3 0 100 2.684m-4.342 6.684a3 3 0 11-2.684-2.684m0 2.684a3 3 0 100-2.684m0-1.342a3 3 0 100 2.684"></path></svg>
                    Compartilhar YouTube
                </button>
               
            </div>
        </div>
    </div>

    <!-- Mini-player <!--
    <div id="miniPlayer" class="mini-player-container hidden rounded-lg shadow-xl overflow-hidden cursor-move">
        <div id="miniPlayerContainer" class="relative w-full h-full">
            <!-- Conteúdo do mini-player -->
        </div>
        <button id="miniPlayerCloseBtn" class="absolute top-2 right-2 text-red-500 hover:text-red-700 transition-colors text-2xl font-bold rounded-full p-1">
            ×
        </button>
        <div id="miniPlayerHandle" class="mini-player-handle absolute top-0 left-0 w-full h-full"></div>
    </div>

    <!-- Conteúdo principal -->
    <main class="container mx-auto p-6 flex-grow pt-40">
        <!-- Vídeo de Destaque -->
        <section class="mb-8">
            <h2 class="text-3xl font-bold mb-4">Em Destaque Hoje</h2>
            <div id="featuredVideoContainer" class="relative w-full rounded-lg overflow-hidden shadow-xl cursor-pointer" style="padding-top: 56.25%;">
                <!-- O vídeo de destaque será inserido aqui -->
                <div id="featuredOverlay" class="absolute inset-0 flex items-center justify-center bg-black bg-opacity-40 hover:bg-opacity-20 transition-all duration-300">
                    <svg class="w-16 h-16 text-white" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"></path>
                    </svg>
                </div>
                <div class="absolute inset-0 flex flex-col justify-end p-6 bg-gradient-to-t from-gray-900 via-transparent to-transparent">
                    <h3 id="featuredVideoTitle" class="text-3xl font-bold"></h3>
                </div>
                <img id="featuredThumbnail" src="" alt="Vídeo em destaque" class="absolute inset-0 w-full h-full object-cover">
            </div>
        </section>

        <!-- Seção de resultados de pesquisa (oculta por padrão) -->
        <section id="searchResultsSection" class="hidden mb-8">
            <h2 class="text-3xl font-bold mb-4">Resultados da Pesquisa</h2>
            <div id="searchResultsGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
                <!-- Os resultados da pesquisa serão inseridos aqui -->
            </div>
        </section>

        <!-- Seções de categorias de vídeos com rolagem horizontal -->
        <div id="videoCategoriesContainer">
            <!-- As seções de categorias serão inseridas aqui pelo JavaScript -->
        </div>

        <!-- Mensagem de "Nenhum vídeo encontrado" -->
        <div id="noResults" class="hidden text-center text-xl text-gray-400 mt-16">
            Nenhum vídeo encontrado com os termos da pesquisa.
        </div>
    </main>

    <!-- Rodapé -->
    <footer class="bg-gray-800 p-4 text-center text-gray-500 text-sm rounded-t-xl mt-8">
        © 2025 Igreja Presbiteriana do Centenário <br> Todos os direitos reservados
    </footer>

    <script>
        // Dados de exemplo para os vídeos.
        
        const videos = [
            { id: 'yODJiiNQ4T8', title: 'Condições para um avivamento jenuíno', category: 'Mensagens', thumbnail: 'https://img.youtube.com/vi/yODJiiNQ4T8/mqdefault.jpg' },
            { id: 'qWTKkY2GaNs', title: 'O casamento de Deus com o seu povo', category: 'Mensagens', thumbnail: 'https://img.youtube.com/vi/qWTKkY2GaNs/mqdefault.jpg' },
            { id: '3mlEJH5b6w4', title: 'Esperança renovada no encontro com Jesus', category: 'Mensagens', thumbnail: 'https://img.youtube.com/vi/3mlEJH5b6w4/mqdefault.jpg' },
            { id: 'fmiGJOV3fKc', title: 'Hora da Despedida', category: 'Mensagens', thumbnail: 'https://img.youtube.com/vi/fmiGJOV3fKc/mqdefault.jpg' },
            { id: 'Zlyg9EQ1dkQ', title: 'Deus nos criou para Eternidade', category: 'Mensagens', thumbnail: 'https://img.youtube.com/vi/Zlyg9EQ1dkQ/mqdefault.jpg' },
            { id: 'jaL7R5S8cpg', title: 'Satisfação na Missão', category: 'Mensagens', thumbnail: 'https://img.youtube.com/vi/jaL7R5S8cpg/mqdefault.jpg' },
            { id: 'P-zJWXYyZQw', title: 'Mude Sua Postura diante de Deus', category: 'Mensagens', thumbnail: 'https://img.youtube.com/vi/P-zJWXYyZQw/mqdefault.jpg' },
            { id: 'dJkFBfL46ZY', title: 'Obediência à Verdade e amor fraternal', category: 'Mensagens', thumbnail: 'https://img.youtube.com/vi/dJkFBfL46ZY/mqdefault.jpg' },
            { id: 'WYwEtR72OBE', title: 'Sou como uma oliveira verdejante na Casa de Deus', category: 'Mensagens', thumbnail: 'https://img.youtube.com/vi/WYwEtR72OBE/mqdefault.jpg' },
            { id: 'U7uHF-hZ-n0', title: 'A Realidade Espiritual', category: 'Mensagens', thumbnail: 'https://img.youtube.com/vi/U7uHF-hZ-n0/mqdefault.jpg' },
            { id: 'O9Uu-X8kWfw', title: 'Pilares de sustentação da nossa casa', category: 'Mensagens', thumbnail: 'https://img.youtube.com/vi/O9Uu-X8kWfw/mqdefault.jpg' },
            { id: 'XmVMLEn-wFc', title: 'Sede Pacientes e Perseverantes', category: 'Mensagens', thumbnail: 'https://img.youtube.com/vi/XmVMLEn-wFc/mqdefault.jpg' },
            { id: '2VoygGqW3XQ', title: 'Ajudando Pessoas a encontrar Jesus', category: 'Mensagens', thumbnail: 'https://img.youtube.com/vi/2VoygGqW3XQ/mqdefault.jpg' },
            { id: 'H8ZzpVFwNDs', title: 'As 7 palavras de Jesus', category: 'Mensagens', thumbnail: 'https://img.youtube.com/vi/H8ZzpVFwNDs/mqdefault.jpg' },
            { id: 'ladGYYSqPA0', title: 'A mulher samaritana e a sua missão', category: 'Mensagens', thumbnail: 'https://img.youtube.com/vi/ladGYYSqPA0/mqdefault.jpg' },
            { id: 'lUxcZC7meiY', title: 'Preparados para o encontro?', category: 'Mensagens', thumbnail: 'https://img.youtube.com/vi/lUxcZC7meiY/mqdefault.jpg' },
            { id: '53eoS8XoQac', title: 'Atitudes para o alívio da alma', category: 'Mensagens', thumbnail: 'https://img.youtube.com/vi/53eoS8XoQac/mqdefault.jpg' },
            { id: 'l_y3HPqe22s', title: 'O desafio de viver Atos 29', category: 'Mensagens', thumbnail: 'https://img.youtube.com/vi/l_y3HPqe22s/mqdefault.jpg' },
            { id: '9dtjX-FQkn8', title: 'O que fazer diante de Jesus?', category: 'Mensagens', thumbnail: 'https://img.youtube.com/vi/9dtjX-FQkn8/mqdefault.jpg' },
            { id: '_fRnddER-1U', title: 'Jesus breve virá', category: 'Mensagens', thumbnail: 'https://img.youtube.com/vi/_fRnddER-1U/mqdefault.jpg' },
            { id: 'i6uIFur3u-8', title: 'Chamados para frutificar', category: 'Mensagens', thumbnail: 'https://img.youtube.com/vi/i6uIFur3u-8/mqdefault.jpg' },
            { id: 'yPddHFascuY', title: 'Deus é fiel em cumprir promessas', category: 'Mensagens', thumbnail: 'https://img.youtube.com/vi/yPddHFascuY/mqdefault.jpg' },
            { id: 'xHEsrdeDUEg', title: 'Deus é Deus de Recomeços', category: 'Mensagens', thumbnail: 'https://img.youtube.com/vi/xHEsrdeDUEg/mqdefault.jpg' },
            { id: 'Jw2LMlSZVsM', title: 'Efésios | PT.1', category: 'Estudos Bíblicos', thumbnail: 'https://img.youtube.com/vi/Jw2LMlSZVsM/mqdefault.jpg' },
            { id: 'Bd4itbmPSDs', title: 'Efésios | PT.2', category: 'Estudos Bíblicos', thumbnail: 'https://img.youtube.com/vi/Bd4itbmPSDs/mqdefault.jpg' },
            { id: 'Y7ehQ_REddk', title: 'O Juízo de Deus | PT. 1', category: 'Estudos Bíblicos', thumbnail: 'https://img.youtube.com/vi/Y7ehQ_REddk/mqdefault.jpg' },
            { id: 'ZntBEoVWW5E', title: 'O Juízo de Deus | PT. 2', category: 'Estudos Bíblicos', thumbnail: 'https://img.youtube.com/vi/ZntBEoVWW5E/mqdefault.jpg' },
            { id: 'Mt2zIlkrcUI', title: 'O Juízo de Deus | PT. 3', category: 'Estudos Bíblicos', thumbnail: 'https://img.youtube.com/vi/Mt2zIlkrcUI/mqdefault.jpg' },
            { id: 'QgrNrHMrsr4', title: 'Vida Longa ao Rei', category: 'Peças Teatrais', thumbnail: 'https://img.youtube.com/vi/QgrNrHMrsr4/mqdefault.jpg' },
            { id: 'Hs9If5vlveg', title: 'Deus o Mundo Amou', category: 'Peças Teatrais', thumbnail: 'https://img.youtube.com/vi/Hs9If5vlveg/mqdefault.jpg' },
            { id: 'eY52Zsg-Kug', title: 'Em desenvolvimento', category: 'Peças Teatrais', thumbnail: 'https://img.youtube.com/vi/eY52Zsg-Kug/mqdefault.jpg' }
        ];

        // Seleciona os elementos da página
        const searchInput = document.getElementById('searchInput');
        const videoModal = document.getElementById('videoModal');
        const closeModalBtn = document.getElementById('closeModalBtn');
        const videoContainer = document.getElementById('videoContainer');
        const videoTitle = document.getElementById('videoTitle');
        const noResults = document.getElementById('noResults');
        const videoCategoriesContainer = document.getElementById('videoCategoriesContainer');
        const searchResultsSection = document.getElementById('searchResultsSection');
        const searchResultsGrid = document.getElementById('searchResultsGrid');
        const categoryButtonsContainer = document.getElementById('categoryButtonsContainer');
        const surpriseMeBtn = document.getElementById('surpriseMeBtn');
        const unwatchedBtn = document.getElementById('unwatchedBtn');
        const miniPlayer = document.getElementById('miniPlayer');
        const miniPlayerContainer = document.getElementById('miniPlayerContainer');
        const miniPlayerCloseBtn = document.getElementById('miniPlayerCloseBtn');
        const minimizeModalBtn = document.getElementById('minimizeModalBtn');
        const shareVideoBtn = document.getElementById('shareVideoBtn');
        const shareAppBtn = document.getElementById('shareAppBtn');
        const featuredVideoContainer = document.getElementById('featuredVideoContainer');
        const floatingHeaderContainer = document.getElementById('floatingHeaderContainer');
        const featuredThumbnail = document.getElementById('featuredThumbnail');
        const featuredVideoTitle = document.getElementById('featuredVideoTitle');
        const featuredOverlay = document.getElementById('featuredOverlay');
        let player; // Variável global para o player do YouTube
        let isMiniPlayerActive = false;
        let lastPlayedVideoId = null;
        let lastScrollY = window.scrollY;
        let videoQueue = []; // Fila de vídeos para reprodução quando a API estiver pronta
        let isYouTubeAPIReady = false;

        // Funções para carregar e salvar dados no localStorage
        const loadWatchedVideos = () => JSON.parse(localStorage.getItem('watchedVideos')) || {};
        const saveWatchedVideos = (watchedVideos) => localStorage.setItem('watchedVideos', JSON.stringify(watchedVideos));

        // Função para obter o vídeo de destaque diário
        const getDailyFeaturedVideo = () => {
            const now = new Date();
            const today = now.getDate();
            const lastFeaturedDate = localStorage.getItem('featuredVideoDate');
            let featuredVideo = JSON.parse(localStorage.getItem('featuredVideo')) || null;

            if (lastFeaturedDate !== null && new Date(lastFeaturedDate).getDate() === today) {
                return featuredVideo;
            } else {
                const newFeaturedVideo = videos[Math.floor(Math.random() * videos.length)];
                localStorage.setItem('featuredVideoDate', now.toISOString());
                localStorage.setItem('featuredVideo', JSON.stringify(newFeaturedVideo));
                return newFeaturedVideo;
            }
        };

        // Função para renderizar o vídeo de destaque
        const renderFeaturedVideo = () => {
            const featuredVideo = getDailyFeaturedVideo();
            if (featuredVideo) {
                featuredThumbnail.src = featuredVideo.thumbnail;
                featuredVideoTitle.textContent = featuredVideo.title;
                featuredVideoContainer.dataset.videoId = featuredVideo.id;
            }
        };

        // Função para criar um card de vídeo
        const createVideoCard = (video, showProgress = false) => {
            const watchedVideos = loadWatchedVideos();
            const videoCard = document.createElement('div');
            videoCard.className = 'video-card bg-gray-800 rounded-xl shadow-xl overflow-hidden flex-none w-64 sm:w-72 cursor-pointer transform transition-transform duration-300 hover:scale-105';
            
            let progressHtml = '';
            if (showProgress && watchedVideos[video.id] && watchedVideos[video.id].lastTime > 0) {
                const progress = (watchedVideos[video.id].lastTime / watchedVideos[video.id].duration) * 100;
                progressHtml = `<div class="absolute bottom-0 left-0 right-0 h-1 bg-gray-600">
                                    <div class="h-full bg-red-600" style="width: ${progress}%;"></div>
                                </div>`;
            }

            videoCard.innerHTML = `
                <div class="relative w-full" style="padding-top: 56.25%;">
                    <img src="${video.thumbnail}" alt="${video.title}" class="absolute inset-0 w-full h-full object-cover">
                    <div class="absolute inset-0 flex items-center justify-center bg-black bg-opacity-40 hover:bg-opacity-20 transition-all duration-300">
                        <svg class="w-16 h-16 text-white" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"></path>
                        </svg>
                    </div>
                    ${progressHtml}
                </div>
                <div class="p-4">
                    <h3 class="text-lg font-semibold leading-tight">${video.title}</h3>
                </div>
            `;
            videoCard.addEventListener('click', () => openVideoModal(video));
            return videoCard;
        };
        
        // Função para renderizar a seção "Continue Assistindo"
        const renderWatchedVideosSection = () => {
            const watchedVideos = loadWatchedVideos();
            const watchedVideoIds = Object.keys(watchedVideos).filter(id => watchedVideos[id].lastTime > 0);
            
            const watchedVideosList = videos.filter(video => watchedVideoIds.includes(video.id));
            
            // Remove a seção anterior se existir
            const existingSection = document.getElementById('continueWatchingSection');
            if (existingSection) {
                existingSection.remove();
            }

            if (watchedVideosList.length > 0) {
                const section = document.createElement('section');
                section.id = 'continueWatchingSection';
                section.className = 'video-category-section mb-8 relative mt-8';

                const title = document.createElement('h2');
                title.className = 'text-3xl font-bold mb-4';
                title.textContent = 'Continue Assistindo';
                section.appendChild(title);

                const horizontalContainer = document.createElement('div');
                horizontalContainer.className = 'relative';

                const scrollContainer = document.createElement('div');
                scrollContainer.className = 'horizontal-scroll-container flex space-x-6 overflow-x-auto pb-4';
                
                watchedVideosList.forEach(video => {
                    scrollContainer.appendChild(createVideoCard(video, true));
                });

                horizontalContainer.appendChild(scrollContainer);
                horizontalContainer.appendChild(createNavButtons(scrollContainer));

                section.appendChild(horizontalContainer);
                videoCategoriesContainer.appendChild(section);
            }
        };

        // Função para rolar para o card mais próximo
        const scrollToNearestCard = (scrollContainer, direction) => {
            const cards = Array.from(scrollContainer.querySelectorAll('.video-card'));
            const containerScrollLeft = scrollContainer.scrollLeft;

            let targetCard = null;
            if (direction === 'next') {
                targetCard = cards.find(card => card.offsetLeft > containerScrollLeft + 1);
            } else { // 'prev'
                const reversedCards = [...cards].reverse();
                targetCard = reversedCards.find(card => card.offsetLeft < containerScrollLeft - 1);
            }

            if (targetCard) {
                scrollContainer.scrollTo({
                    left: targetCard.offsetLeft,
                    behavior: 'smooth'
                });
            }
        };


        // Função para criar os botões de navegação
        const createNavButtons = (scrollContainer) => {
            const container = document.createElement('div');
            container.className = 'absolute inset-y-0 left-0 right-0 flex items-center justify-between pointer-events-none px-2';

            const prevBtn = document.createElement('button');
            prevBtn.className = 'prev-btn p-2 bg-gray-800 bg-opacity-50 text-white rounded-full pointer-events-auto transition-opacity duration-300 opacity-0 hover:opacity-100';
            prevBtn.innerHTML = `<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>`;
            prevBtn.onclick = () => {
                 scrollToNearestCard(scrollContainer, 'prev');
            };

            const nextBtn = document.createElement('button');
            nextBtn.className = 'next-btn p-2 bg-gray-800 bg-opacity-50 text-white rounded-full pointer-events-auto transition-opacity duration-300 opacity-0 hover:opacity-100';
            nextBtn.innerHTML = `<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>`;
            nextBtn.onclick = () => {
                 scrollToNearestCard(scrollContainer, 'next');
            };

            // Adiciona a lógica para mostrar/ocultar os botões de navegação
            const updateButtonVisibility = () => {
                if (scrollContainer.scrollLeft > 0) {
                    prevBtn.classList.remove('opacity-0');
                } else {
                    prevBtn.classList.add('opacity-0');
                }

                if (scrollContainer.scrollLeft + scrollContainer.clientWidth >= scrollContainer.scrollWidth) {
                    nextBtn.classList.add('opacity-0');
                } else {
                    nextBtn.classList.remove('opacity-0');
                }
            };

            scrollContainer.addEventListener('scroll', updateButtonVisibility);
            setTimeout(updateButtonVisibility, 300); // Garante que os botões apareçam corretamente ao carregar
            
            container.appendChild(prevBtn);
            container.appendChild(nextBtn);
            return container;
        };
        
        // Função para renderizar as seções de categorias e os botões de filtro
        const renderCategories = (filteredVideos = videos) => {
            const uniqueCategories = ['Todos', ...new Set(filteredVideos.map(video => video.category))];
            
            // Limpa o container de botões e o recria
            categoryButtonsContainer.innerHTML = '';
            uniqueCategories.forEach(category => {
                const button = document.createElement('button');
                button.className = 'categoryBtn flex-none px-4 py-2 bg-gray-700 hover:bg-red-600 transition-colors text-sm rounded-full shadow-lg';
                button.dataset.category = category;
                button.textContent = category;
                categoryButtonsContainer.appendChild(button);
            });

            // Adiciona o event listener para os botões de categoria
            document.querySelectorAll('.categoryBtn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const category = e.target.dataset.category;
                    
                    document.querySelectorAll('.categoryBtn').forEach(btn => btn.classList.remove('bg-red-600', 'hover:bg-red-700'));
                    e.target.classList.add('bg-red-600', 'hover:bg-red-700');
                    
                    document.querySelectorAll('.video-category-section').forEach(section => {
                        section.classList.add('hidden');
                    });
                    
                    searchResultsSection.classList.add('hidden');
                    noResults.classList.add('hidden');
                    
                    if (category === 'Todos') {
                        document.querySelectorAll('.video-category-section').forEach(section => {
                            section.classList.remove('hidden');
                        });
                    } else {
                        const sectionToShow = document.getElementById(`category-${category.replace(/\s/g, '-')}`);
                        if (sectionToShow) {
                            sectionToShow.classList.remove('hidden');
                        }
                    }
                });
            });

            // Cria as seções de carrossel de vídeo para cada categoria
            videoCategoriesContainer.innerHTML = '';
            uniqueCategories.filter(cat => cat !== 'Todos').forEach(category => {
                const categorySection = document.createElement('section');
                categorySection.id = `category-${category.replace(/\s/g, '-')}`;
                categorySection.className = 'video-category-section mb-8 relative';

                const sectionTitle = document.createElement('h2');
                sectionTitle.className = 'text-3xl font-bold mb-4';
                sectionTitle.textContent = category;
                categorySection.appendChild(sectionTitle);

                const horizontalContainer = document.createElement('div');
                horizontalContainer.className = 'relative';

                const scrollContainer = document.createElement('div');
                scrollContainer.className = 'horizontal-scroll-container flex space-x-6 overflow-x-auto pb-4';

                const categoryVideos = filteredVideos.filter(video => video.category === category);
                categoryVideos.forEach(video => {
                    scrollContainer.appendChild(createVideoCard(video));
                });
                
                horizontalContainer.appendChild(scrollContainer);
                horizontalContainer.appendChild(createNavButtons(scrollContainer));

                categorySection.appendChild(horizontalContainer);
                videoCategoriesContainer.appendChild(categorySection);
            });
            renderWatchedVideosSection();
        };

        // Função para carregar e iniciar o player do YouTube dentro do modal
        const loadPlayer = (videoId, startTime = 0, containerId = 'videoContainer') => {
            if (player) {
                player.destroy();
            }

            // Cria o elemento div para o player dentro do contêiner
            const playerDiv = document.createElement('div');
            playerDiv.id = 'youtubePlayer';
            // Garante que o contêiner seja limpo antes de adicionar um novo player
            document.getElementById(containerId).innerHTML = '';
            document.getElementById(containerId).appendChild(playerDiv);

            player = new YT.Player(playerDiv, {
                videoId: videoId,
                playerVars: {
                    'autoplay': 1,
                    'controls': 1,
                    'rel': 0,
                    'start': startTime
                },
                events: {
                    'onStateChange': (event) => {
                        const watchedVideos = loadWatchedVideos();
                        if (!watchedVideos[videoId]) {
                            watchedVideos[videoId] = {};
                        }
                        
                        if (event.data === YT.PlayerState.PLAYING) {
                            // Salva o tempo de reprodução a cada 3 segundos
                            setInterval(() => {
                                if (player && player.getPlayerState() === YT.PlayerState.PLAYING) {
                                    watchedVideos[videoId].lastTime = player.getCurrentTime();
                                    watchedVideos[videoId].duration = player.getDuration();
                                    saveWatchedVideos(watchedVideos);
                                }
                            }, 3000);
                        } else if (event.data === YT.PlayerState.ENDED) {
                            // Limpa o tempo ao finalizar o vídeo
                            watchedVideos[videoId].lastTime = 0;
                            saveWatchedVideos(watchedVideos);
                            renderWatchedVideosSection();
                        }
                    },
                    'onReady': (event) => {
                        // Tenta tocar o vídeo a partir do tempo salvo
                        if (startTime > 0) {
                            event.target.seekTo(startTime);
                        }
                        event.target.playVideo();
                        // Tenta entrar em fullscreen se o dispositivo estiver na horizontal
                        if (window.innerWidth > window.innerHeight) {
                            enterFullscreen(event.target.getIframe());
                        }
                    }
                }
            });
        };

        const openVideoModal = (video) => {
            if (!isYouTubeAPIReady) {
                videoQueue.push(video);
                console.log("YouTube API is not ready. Queued video:", video.title);
                return;
            }

            if (isMiniPlayerActive) {
                closeMiniPlayer();
            }

            const watchedVideos = loadWatchedVideos();
            const startTime = watchedVideos[video.id] ? watchedVideos[video.id].lastTime : 0;

            videoModal.classList.remove('hidden');
            document.body.classList.add('overflow-hidden');
            videoTitle.textContent = video.title;
            lastPlayedVideoId = video.id;

            loadPlayer(video.id, startTime, 'videoContainer');
        };

        // Função para fechar o modal
        const closeVideoModal = () => {
            videoModal.classList.add('hidden');
            document.body.classList.remove('overflow-hidden');
            if (player) {
                player.destroy();
                player = null;
            }
        };

        // Função para minimizar o modal para o mini-player
        const minimizeVideoModal = () => {
            if (lastPlayedVideoId) {
                videoModal.classList.add('hidden');
                document.body.classList.remove('overflow-hidden');
                miniPlayer.classList.remove('hidden');
                isMiniPlayerActive = true;
                
                // Reposiciona o player para o mini-player
                const iframe = videoContainer.querySelector('iframe');
                if (iframe) {
                    miniPlayerContainer.innerHTML = '';
                    miniPlayerContainer.appendChild(iframe);
                }
            }
        };

        // Função para fechar o mini-player
        const closeMiniPlayer = () => {
            miniPlayer.classList.add('hidden');
            isMiniPlayerActive = false;
            if (player) {
                player.destroy();
                player = null;
            }
        };
        
        // Função para ativar a tela cheia
        const enterFullscreen = (element) => {
            if (element) {
                if (element.requestFullscreen) {
                    element.requestFullscreen();
                } else if (element.webkitRequestFullscreen) { /* Safari */
                    element.webkitRequestFullscreen();
                } else if (element.msRequestFullscreen) { /* IE11 */
                    element.msRequestFullscreen();
                }
            }
        };

        // Adiciona um listener para a mudança de orientação e verifica o modo fullscreen
        window.addEventListener('orientationchange', () => {
            // Adiciona um pequeno atraso para garantir que o player do YouTube esteja completamente pronto para o fullscreen
            setTimeout(() => {
                if (player && player.getIframe() && window.innerWidth > window.innerHeight) {
                    enterFullscreen(player.getIframe());
                }
            }, 500); // Atraso de 500ms
        });
        
        // Lidar com a funcionalidade de arrastar e soltar do mini-player
        const miniPlayerHandle = document.getElementById('miniPlayerHandle');
        let isDragging = false;
        let initialX, initialY;

        miniPlayerHandle.addEventListener('mousedown', (e) => {
            isDragging = true;
            initialX = e.clientX;
            initialY = e.clientY;
            miniPlayer.style.cursor = 'grabbing';
        });

        document.addEventListener('mousemove', (e) => {
            if (!isDragging) return;
            const dx = e.clientX - initialX;
            const dy = e.clientY - initialY;

            const rect = miniPlayer.getBoundingClientRect();
            let newX = rect.left + dx;
            let newY = rect.top + dy;

            newX = Math.max(0, Math.min(newX, window.innerWidth - rect.width));
            newY = Math.max(0, Math.min(newY, window.innerHeight - rect.height));

            miniPlayer.style.left = `${newX}px`;
            miniPlayer.style.top = `${newY}px`;
            miniPlayer.style.right = 'auto';
            miniPlayer.style.bottom = 'auto';

            initialX = e.clientX;
            initialY = e.clientY;
        });

        document.addEventListener('mouseup', () => {
            if (isDragging) {
                isDragging = false;
                miniPlayer.style.cursor = 'grab';
            }
        });

        // Event listener para o botão de pesquisa
        searchInput.addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            const filteredVideos = videos.filter(video =>
                video.title.toLowerCase().includes(searchTerm)
            );
            
            // Oculta todas as seções de categorias
            document.querySelectorAll('.video-category-section').forEach(section => section.classList.add('hidden'));

            if (searchTerm.length > 0) {
                searchResultsSection.classList.remove('hidden');
                searchResultsGrid.innerHTML = '';
                if (filteredVideos.length > 0) {
                    noResults.classList.add('hidden');
                    filteredVideos.forEach(video => {
                        searchResultsGrid.appendChild(createVideoCard(video));
                    });
                } else {
                    noResults.classList.remove('hidden');
                    noResults.textContent = 'Nenhum vídeo encontrado com os termos da pesquisa.';
                }
            } else {
                searchResultsSection.classList.add('hidden');
                noResults.classList.add('hidden');
                // Mostra todas as seções de categorias novamente
                document.querySelectorAll('.video-category-section').forEach(section => section.classList.remove('hidden'));
            }
        });

        // Event listeners para o modal de vídeo
        closeModalBtn.addEventListener('click', closeVideoModal);
        minimizeModalBtn.addEventListener('click', minimizeVideoModal);
        miniPlayerCloseBtn.addEventListener('click', closeMiniPlayer);

        // Event listener para o botão "Compartilhar YouTube"
        shareVideoBtn.addEventListener('click', () => {
            if (navigator.share) {
                const videoUrl = `https://www.youtube.com/watch?v=${lastPlayedVideoId}`;
                const videoInfo = videos.find(v => v.id === lastPlayedVideoId);
                navigator.share({
                    title: videoInfo.title,
                    text: `Conheça nosso APP https://helisonesc.github.io/IPCApp2/ e assista a este e outros vídeo da Igreja Presbiteriana do Centenário: ${videoInfo.title}`,
                    url: videoUrl,
                }).catch((error) => console.log('Erro ao compartilhar', error));
            } else {
                alert("A API de compartilhamento não é suportada neste navegador.");
            }
        });

        // Event listener para o novo botão "Compartilhar App"
        shareAppBtn.addEventListener('click', () => {
            if (navigator.share) {
                const videoInfo = videos.find(v => v.id === lastPlayedVideoId);
                const appUrl = `${window.location.origin}?v=${lastPlayedVideoId}`;
                
                navigator.share({
                    title: videoInfo.title,
                    text: `Assista a este vídeo no nosso aplicativo: ${videoInfo.title}`,
                    url: appUrl,
                }).catch((error) => console.log('Erro ao compartilhar', error));
            } else {
                alert("A API de compartilhamento não é suportada neste navegador.");
            }
        });


        // Event listener para o botão "Surpreenda-se"
        surpriseMeBtn.addEventListener('click', () => {
            const allVideos = videos;
            const randomVideo = allVideos[Math.floor(Math.random() * allVideos.length)];
            openVideoModal(randomVideo);
        });
        
        // Event listener para o botão "Não assistidos"
        unwatchedBtn.addEventListener('click', () => {
            const watchedVideos = loadWatchedVideos();
            const unwatchedVideos = videos.filter(video => !watchedVideos[video.id] || watchedVideos[video.id].lastTime === 0);
            
            // Oculta as seções de categorias originais
            document.querySelectorAll('.video-category-section').forEach(section => section.classList.add('hidden'));

            searchResultsSection.classList.remove('hidden');
            searchResultsGrid.innerHTML = '';
            
            if (unwatchedVideos.length > 0) {
                noResults.classList.add('hidden');
                unwatchedVideos.forEach(video => {
                    searchResultsGrid.appendChild(createVideoCard(video));
                });
            } else {
                noResults.classList.remove('hidden');
                noResults.textContent = 'Parabéns! Você já assistiu a todos os vídeos.';
            }

            // Remove a seleção de outros botões e destaca o "Não assistidos"
            document.querySelectorAll('.categoryBtn').forEach(btn => btn.classList.remove('bg-red-600', 'hover:bg-red-700'));
            unwatchedBtn.classList.add('bg-purple-600', 'hover:bg-purple-700');
        });

        // Event listener para o vídeo de destaque
        featuredVideoContainer.addEventListener('click', () => {
            const featuredVideoId = featuredVideoContainer.dataset.videoId;
            const featuredVideo = videos.find(v => v.id === featuredVideoId);
            if (featuredVideo) {
                openVideoModal(featuredVideo);
            }
        });

        // Oculta/mostra o cabeçalho flutuante ao rolar
        window.addEventListener('scroll', () => {
            const currentScrollY = window.scrollY;
            if (currentScrollY > lastScrollY && currentScrollY > 100) {
                floatingHeaderContainer.classList.add('hidden-header');
            } else {
                floatingHeaderContainer.classList.remove('hidden-header');
            }
            lastScrollY = currentScrollY;
        });
        
        // Função para carregar o script da API do YouTube
        const loadYouTubeAPI = () => {
            if (!document.getElementById('youtube-iframe-api')) {
                const tag = document.createElement('script');
                tag.src = "https://www.youtube.com/iframe_api";
                tag.id = "youtube-iframe-api";
                const firstScriptTag = document.getElementsByTagName('script')[0];
                firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
            }
        };


        // Função chamada quando a API do YouTube está pronta.
        window.onYouTubeIframeAPIReady = () => {
            console.log("YouTube API is ready. Rendering page content.");
            isYouTubeAPIReady = true;
            renderFeaturedVideo();
            renderCategories();
            videoQueue.forEach(video => openVideoModal(video));
            videoQueue = [];
        };



        // Inicia o processo de carregamento da API do YouTube
        loadYouTubeAPI();

    </script>
</body>
</html>


