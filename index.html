<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APP Centenário</title>
    <!-- Inclui a biblioteca Tailwind CSS para estilização rápida e responsiva -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Configura a fonte "Roboto" para uma leitura clara e moderna-->
    <style>
        body {
            font-family: 'Roboto', sans-serif;
        }
        /* Estilos personalizados para o carrossel horizontal */
        .horizontal-scroll-container {
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none; /* Firefox */
        }
        .horizontal-scroll-container::-webkit-scrollbar {
            display: none; /* Chrome, Safari, Opera */
        }
        /* Animação para o ícone de rotação */
        @keyframes rotatePhone {
            0% { transform: rotate(0deg); }
            25% { transform: rotate(15deg); }
            50% { transform: rotate(0deg); }
            75% { transform: rotate(-15deg); }
            100% { transform: rotate(0deg); }
        }
        .animate-rotate {
            animation: rotatePhone 2s infinite;
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen flex flex-col">

    <!-- Cabeçalho com o título e campo de pesquisa -->
    <header class="bg-gray-800 p-6 flex flex-col sm:flex-row items-center justify-between rounded-b-xl shadow-lg">
        <h1 class="text-4xl sm:text-3xl font-bold mb-4 sm:mb-0">IP Centenário App</h1>
        <div class="relative w-full sm:w-80">
            <input type="text" id="searchInput" placeholder="Pesquisar vídeos..." class="w-full pl-10 pr-4 py-2 bg-gray-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-red-600 focus:border-transparent text-lg">
            <svg class="w-5 h-5 text-gray-400 absolute left-3 top-1/2 transform -translate-y-1/2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd"></path>
            </svg>
        </div>
    </header>

    <!-- Modal para exibir o vídeo em tela cheia -->
    <div id="videoModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center p-4 z-50 transition-opacity duration-300 ease-in-out">
        <div class="bg-gray-900 rounded-lg shadow-xl p-6 relative w-full max-w-4xl max-h-full overflow-hidden">
            <button id="closeModalBtn" class="absolute top-4 right-4 text-red-500 hover:text-red-700 transition-colors text-2xl font-bold rounded-full p-2">
                &times;
            </button>
            <div id="videoContainer" class="relative" style="padding-top: 56.25%;">
                <!-- O vídeo do YouTube será inserido aqui -->
            </div>
            <h2 id="videoTitle" class="mt-4 text-center text-2xl font-semibold"></h2>
        </div>
    </div>
    
    <!-- Mini-player flutuante -->
    <div id="miniPlayer" class="hidden fixed bottom-4 right-4 z-40 w-80 h-48 bg-gray-900 rounded-lg shadow-2xl overflow-hidden cursor-move transition-transform duration-300 ease-in-out">
        <button id="closeMiniPlayerBtn" class="absolute top-1 right-1 text-red-500 hover:text-red-700 transition-colors text-xl font-bold rounded-full p-1 z-50">
            &times;
        </button>
        <div id="miniPlayerVideoContainer" class="w-full h-full relative">
            <!-- Camada invisível para permitir o arrasto sobre o iframe -->
            <!-- A classe `pointer-events-none` impede que o elemento capture eventos do mouse por padrão -->
            <div id="dragOverlay" class="absolute inset-0 z-40 cursor-move"></div>
            <!-- O iframe do vídeo será inserido aqui -->
        </div>
    </div>

    <!-- Mensagem de rotação flutuante (nova) -->
    <div id="rotateMessage" class="hidden fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 p-4 bg-gray-800 rounded-lg shadow-lg z-50 transition-opacity duration-300">
        <div class="flex flex-col items-center">
            <!-- Ícone SVG de celular para a animação -->
            <svg id="phoneRotateIcon" class="w-16 h-16 text-white mb-2" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M15.5 2h-7A2.5 2.5 0 0 0 6 4.5v15A2.5 2.5 0 0 0 8.5 22h7a2.5 2.5 0 0 0 2.5-2.5v-15A2.5 2.5 0 0 0 15.5 2zM12 21a1 1 0 1 1 0-2 1 1 0 0 1 0 2z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M4 10a1 1 0 0 1 0-2M4 14a1 1 0 0 1 0-2M4 18a1 1 0 0 1 0-2M20 10a1 1 0 0 1 0-2M20 14a1 1 0 0 1 0-2M20 18a1 1 0 0 1 0-2" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <p class="text-white text-center">Para melhor visualização, gire seu celular!</p>
        </div>
    </div>

    <!-- Conteúdo principal com categorias e grade de vídeos -->
    <main class="container mx-auto p-6 flex-grow">
        <!-- Seção de Categorias (Botões) -->
        <div class="flex flex-wrap justify-center sm:justify-start gap-4 mb-8">
            <button class="categoryBtn px-6 py-3 bg-gray-700 hover:bg-red-600 transition-colors text-lg rounded-full shadow-lg" data-category="Todos">Todos</button>
            <button class="categoryBtn px-6 py-3 bg-gray-700 hover:bg-red-600 transition-colors text-lg rounded-full shadow-lg" data-category="Não Assistidos">Não Assistidos</button>
            <!-- Os botões de categoria restantes serão criados dinamicamente pelo JavaScript -->
        </div>

        <!-- Seção de resultados de pesquisa (oculta por padrão) -->
        <section id="searchResultsSection" class="hidden mb-8">
            <h2 class="text-3xl font-bold mb-4">Resultados da Pesquisa</h2>
            <div id="searchResultsGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
                <!-- Os resultados da pesquisa serão inseridos aqui -->
            </div>
        </section>

        <!-- Seções de categorias de vídeos com rolagem horizontal -->
        <div id="videoCategoriesContainer">
            <!-- As seções de categorias serão inseridas aqui pelo JavaScript -->
        </div>

        <!-- Mensagem de "Nenhum vídeo encontrado" -->
        <div id="noResults" class="hidden text-center text-xl text-gray-400 mt-16">
            Nenhum vídeo encontrado com os termos da pesquisa.
        </div>
    </main>

    <!-- Rodapé -->
    <footer class="bg-gray-800 p-4 text-center text-gray-500 text-sm rounded-t-xl mt-8">
        © 2025 IP Centenário. Todos os direitos reservados.
    </footer>

    <script>
        // Use uma estrutura de dados simples para seus vídeos.
        // Copie o ID do vídeo do YouTube (a parte final da URL, por exemplo: "dQw4w9WgXcQ").
        // ATENÇÃO: Substitua os dados abaixo pelos vídeos do seu canal!
        const videos = [
            {
                id: 'yODJiiNQ4T8',
                title: 'Condições para um avivamento jenuíno',
                category: 'Mensagens',
                thumbnail: 'https://i9.ytimg.com/vi_webp/yODJiiNQ4T8/mqdefault.webp?v=68ac6154&sqp=CJyh1sUG&rs=AOn4CLAp-DvDB-1p_cGx_7CKM72Gi2H0Dw'
            },
            {
                id: 'qWTKkY2GaNs',
                title: 'O casamento de Deus com o seu povo',
                category: 'Mensagens',
                thumbnail: 'https://i9.ytimg.com/vi_webp/yODJiiNQ4T8/mqdefault.webp?v=68ac6154&sqp=CJyh1sUG&rs=AOn4CLAp-DvDB-1p_cGx_7CKM72Gi2H0Dw'
            },
            {
                id: '3mlEJH5b6w4',
                title: 'Esperança renovada no encontro com Jesus',
                category: 'Mensagens',
                thumbnail: 'https://i9.ytimg.com/vi_webp/3mlEJH5b6w4/mqdefault.webp?v=68916303&sqp=CJyh1sUG&rs=AOn4CLBU9Rt3m8rMN2jGEji-8fH34mbStQ'
            },
            {
                id: 'fmiGJOV3fKc',
                title: 'Hora da Despedida',
                category: 'Mensagens',
                thumbnail: 'https://i9.ytimg.com/vi_webp/fmiGJOV3fKc/mqdefault.webp?v=6887c090&sqp=CJyh1sUG&rs=AOn4CLD5cbcbZUGzDIFE6zk6dbu_XSwqxA'
            },
            {
                id: 'Zlyg9EQ1dkQ',
                title: 'Deus nos criou para Eternidade',
                category: 'Mensagens',
                thumbnail: 'https://i9.ytimg.com/vi_webp/Zlyg9EQ1dkQ/mqdefault.webp?v=68841d6d&sqp=CMij1sUG&rs=AOn4CLClBU-8wc9gces0TPYbrhvL5xLH9g'
            },
            {
                id: 'jaL7R5S8cpg',
                title: 'Satisfação na Missão',
                category: 'Mensagens',
                thumbnail: 'https://i9.ytimg.com/vi_webp/jaL7R5S8cpg/mqdefault.webp?v=68745d40&sqp=CMij1sUG&rs=AOn4CLCTntcgv8GqsZYwzgB4mN1zyeFt6g'
            },
{
                id: 'P-zJWXYyZQw',
                title: 'Mude Sua Postura diante de Deus',
                category: 'Mensagens',
                thumbnail: 'https://i9.ytimg.com/vi_webp/P-zJWXYyZQw/mqdefault.webp?v=6871b485&sqp=CMij1sUG&rs=AOn4CLAnii37OotdEH6fAQVTb-24kqABww'
            },
{
                id: 'dJkFBfL46ZY',
                title: 'Obediência à Verdade e amor fraternal',
                category: 'Mensagens',
                thumbnail: 'https://i9.ytimg.com/vi_webp/dJkFBfL46ZY/mqdefault.webp?v=685bf61d&sqp=CMij1sUG&rs=AOn4CLBKb05a8t1KFuZEjX0DpuF20_laaA'
            },
{
                id: 'WYwEtR72OBE',
                title: 'Sou como uma oliveira verdejante na Casa de Deus',
                category: 'Mensagens',
                thumbnail: 'https://i9.ytimg.com/vi/WYwEtR72OBE/mqdefault.jpg?v=685017a0&sqp=CMij1sUG&rs=AOn4CLBpeAByZ-_U0L1_fhlpdsCPinerDQ'
            },
{
                id: 'U7uHF-hZ-n0',
                title: 'A Realidade Espiritual',
                category: 'Mensagens',
                thumbnail: 'https://i9.ytimg.com/vi_webp/U7uHF-hZ-n0/mqdefault.webp?v=6846f988&sqp=CMij1sUG&rs=AOn4CLADyw0puAjQdmDoperLHIdp6j5c-Q'
            },
{
                id: 'O9Uu-X8kWfw',
                title: 'Pilares de sustentação da nossa casa',
                category: 'Mensagens',
                thumbnail: 'https://i9.ytimg.com/vi_webp/O9Uu-X8kWfw/mqdefault.webp?v=68346be8&sqp=CMij1sUG&rs=AOn4CLCpj9nUoeEBQxKpMv7xC21NpEExzQ'
            },
{
                id: 'XmVMLEn-wFc',
                title: 'Sede Pacientes e Perseverantes',
                category: 'Mensagens',
                thumbnail: 'https://i9.ytimg.com/vi_webp/XmVMLEn-wFc/mqdefault.webp?v=68220717&sqp=CMij1sUG&rs=AOn4CLB_YeTM7hztQbJrDwEVzD8k0HiiQw'
            },
{
                id: '2VoygGqW3XQ',
                title: 'Ajudando Pessoas a encontrar Jesus',
                category: 'Mensagens',
                thumbnail: 'https://i9.ytimg.com/vi_webp/2VoygGqW3XQ/mqdefault.webp?v=6818b9b3&sqp=CMij1sUG&rs=AOn4CLA_X63JMTnz-KwoEgVCeTbMnDU9jA'
            },
{
                id: 'H8ZzpVFwNDs',
                title: 'As 7 palavras de Jesus',
                category: 'Mensagens',
                thumbnail: 'https://i9.ytimg.com/vi/H8ZzpVFwNDs/mqdefault.jpg?v=680ff24b&sqp=CMij1sUG&rs=AOn4CLAjX9-qPaLvbC-U2qpidm6Yc9w0rg'
            },
{
                id: 'ladGYYSqPA0',
                title: 'A mulher samaritana e a sua missão',
                category: 'Mensagens',
                thumbnail: 'https://i9.ytimg.com/vi/ladGYYSqPA0/mqdefault.jpg?v=680fa106&sqp=CMij1sUG&rs=AOn4CLBcLb8uBxX9fnIKwh7LFqNrftoWwg'
            },
{
                id: 'lUxcZC7meiY',
                title: 'Preparados para o encontro?',
                category: 'Mensagens',
                thumbnail: 'https://i9.ytimg.com/vi/lUxcZC7meiY/mqdefault.jpg?v=68080ec4&sqp=CMij1sUG&rs=AOn4CLDxYOpKDJ8Jja38HBHzEY0z1UTczA'
            },
{
                id: '53eoS8XoQac',
                title: 'Atitudes para o alívio da alma',
                category: 'Mensagens',
                thumbnail: 'https://i9.ytimg.com/vi_webp/53eoS8XoQac/mqdefault.webp?v=67fd0e02&sqp=CMij1sUG&rs=AOn4CLD_AhMmZzHM5-i5cboYUQZ3LwvEPg'
            },
{
                id: 'l_y3HPqe22s',
                title: 'O desafio de viver Atos 29',
                category: 'Mensagens',
                thumbnail: 'https://i9.ytimg.com/vi_webp/l_y3HPqe22s/mqdefault.webp?v=67f46347&sqp=CMij1sUG&rs=AOn4CLDf4JcHHbxxcl1ItWVCfDIXZKs7Tg'
            },
{
                id: '9dtjX-FQkn8',
                title: 'O que fazer diante de Jesus?',
                category: 'Mensagens',
                thumbnail: 'https://i9.ytimg.com/vi/9dtjX-FQkn8/mqdefault.jpg?v=67eb3c63&sqp=CMij1sUG&rs=AOn4CLDQ3ebHSQtxdd00tSH6hmANUBBF6g'
            },
{
                id: '_fRnddER-1U',
                title: 'Jesus breve virá',
                category: 'Mensagens',
                thumbnail: 'https://i9.ytimg.com/vi/_fRnddER-1U/mqdefault.jpg?v=67e199af&sqp=CMij1sUG&rs=AOn4CLDWO99TPp6LR0nZqHrmRb33SKsQGA'
            },
{
                id: 'i6uIFur3u-8',
                title: 'Chamados para frutificar',
                category: 'Mensagens',
                thumbnail: 'https://i9.ytimg.com/vi/i6uIFur3u-8/mqdefault.jpg?v=6786b133&sqp=CMij1sUG&rs=AOn4CLBI2ENV9KULHWm2-EE3DjPDVSPztw'
            },
{
                id: 'yPddHFascuY',
                title: 'Deus é fiel em cumprir promessas',
                category: 'Mensagens',
                thumbnail: 'https://i9.ytimg.com/vi/yPddHFascuY/mqdefault.jpg?v=677c886a&sqp=CMij1sUG&rs=AOn4CLAIAGFo9KUN1ySoFsCs01FAANNkOQ'
            },
{
                id: 'xHEsrdeDUEg',
                title: 'Deus é Deus de Recomeços',
                category: 'Mensagens',
                thumbnail: 'https://i9.ytimg.com/vi_webp/xHEsrdeDUEg/mqdefault.webp?v=6776c161&sqp=CMij1sUG&rs=AOn4CLAT5yThviwinGI_2k4MyKiQ6cJ4YQ'
            },
{
                id: 'Jw2LMlSZVsM',
                title: 'Efésios | PT.1',
                category: 'Estudos Bíblicos',
                thumbnail: 'https://i9.ytimg.com/vi/Jw2LMlSZVsM/mqdefault.jpg?v=68718d86&sqp=CKSv1sUG&rs=AOn4CLDCZp508ZsTfVhwJiqJDisUn7kbSA'
            },


{
                id: 'Bd4itbmPSDs',
                title: 'Efésios | PT.2',
                category: 'Estudos Bíblicos',
                thumbnail: 'https://i9.ytimg.com/vi/Bd4itbmPSDs/mqdefault.jpg?v=6867dc3a&sqp=CKSv1sUG&rs=AOn4CLCRkWABa9yqBzQkMkQW8TSHL3Oy_w'
            },
{
                id: 'Y7ehQ_REddk',
                title: 'O Juízo de Deus | PT. 1',
                category: 'Estudos Bíblicos',
                thumbnail: 'https://i9.ytimg.com/vi_webp/Y7ehQ_REddk/mqdefault.webp?v=684d8bbf&sqp=CKSv1sUG&rs=AOn4CLDBMoKtwdCxw_An1sZkGSoEvJ-QrA'
            },
{
                id: 'ZntBEoVWW5E',
                title: 'O Juízo de Deus | PT. 2',
                category: 'Estudos Bíblicos',
                thumbnail: 'https://i9.ytimg.com/vi/ZntBEoVWW5E/mqdefault.jpg?v=6855ca55&sqp=CKSv1sUG&rs=AOn4CLDIrHy8pkZYE8oBlEaKFFWJtaFqiQ'
            },
{
                id: 'Mt2zIlkrcUI',
                title: 'O Juízo de Deus | PT. 3',
                category: 'Estudos Bíblicos',
                thumbnail: 'https://i9.ytimg.com/vi/Mt2zIlkrcUI/mqdefault.jpg?v=68614e2c&sqp=CNCx1sUG&rs=AOn4CLArwdPxvobFZYoAf2Oxl_LIDrXTQQ'
            },

{
                id: 'QgrNrHMrsr4',
                title: 'Vida Longa ao Rei',
                category: 'Peças Teatrais',
                thumbnail: 'https://i9.ytimg.com/vi_webp/QgrNrHMrsr4/mq2.webp?sqp=CKSv1sUG&rs=AOn4CLDEmRm5fXzmJVxFgPI0rRkSX3699g'
            },
{
                id: 'Hs9If5vlveg',
                title: 'Deus o Mundo Amou',
                category: 'Peças Teatrais',
                thumbnail: 'https://i9.ytimg.com/vi_webp/Hs9If5vlveg/mq2.webp?sqp=CKSv1sUG-oaymwEmCMACELQB8quKqQMa8AEB-AH-CYAC0AWKAgwIABABGCQgPCh_MA8=&rs=AOn4CLBsxWVxpV9NBD7VdPrIxh6yQEF5hg'
            },


            {
                id: 'eY52Zsg-Kug',
                title: 'Em desenvolvimento',
                category: 'Peças Teatrais',
                thumbnail: 'https://i.ytimg.com/vi/eY52Zsg-Kug/hqdefault.jpg'
            }
        ];

       // Seleciona os elementos da página
        const searchInput = document.getElementById('searchInput');
        const videoModal = document.getElementById('videoModal');
        const closeModalBtn = document.getElementById('closeModalBtn');
        const videoContainer = document.getElementById('videoContainer');
        const videoTitle = document.getElementById('videoTitle');
        const noResults = document.getElementById('noResults');
        const videoCategoriesContainer = document.getElementById('videoCategoriesContainer');
        const searchResultsSection = document.getElementById('searchResultsSection');
        const searchResultsGrid = document.getElementById('searchResultsGrid');
        const categoryButtonsContainer = document.querySelector('.flex.flex-wrap');
        const miniPlayer = document.getElementById('miniPlayer');
        const miniPlayerVideoContainer = document.getElementById('miniPlayerVideoContainer');
        const closeMiniPlayerBtn = document.getElementById('closeMiniPlayerBtn');
        const dragOverlay = document.getElementById('dragOverlay');
        const rotateMessage = document.getElementById('rotateMessage');
        const phoneRotateIcon = document.getElementById('phoneRotateIcon');

        // Variáveis para rastrear o estado do vídeo
        let watchTimer;
        let watchedVideos = new Set();
        const WATCH_THRESHOLD = 300000; // 5 minutos em milissegundos

        // Função para carregar os vídeos assistidos do localStorage
        const loadWatchedVideos = () => {
            const storedVideos = localStorage.getItem('watchedVideos');
            if (storedVideos) {
                watchedVideos = new Set(JSON.parse(storedVideos));
            }
        };

        // Função para salvar um vídeo como assistido no localStorage
        const markVideoAsWatched = (videoId) => {
            watchedVideos.add(videoId);
            localStorage.setItem('watchedVideos', JSON.stringify(Array.from(watchedVideos)));
            // Atualiza a interface para mostrar a marca de "visto"
            const updatedVideo = videos.find(v => v.id === videoId);
            if (updatedVideo) {
                renderCategories();
            }
        };

        // Função para criar um card de vídeo
        const createVideoCard = (video) => {
            const videoCard = document.createElement('div');
            // Adiciona a classe 'watched' se o vídeo já foi assistido
            videoCard.className = `video-card bg-gray-800 rounded-xl shadow-xl overflow-hidden flex-none w-64 sm:w-72 cursor-pointer transform transition-transform duration-300 hover:scale-105 relative ${watchedVideos.has(video.id) ? 'opacity-75' : ''}`;
            
            const isWatched = watchedVideos.has(video.id);

            videoCard.innerHTML = `
                <div class="relative w-full" style="padding-top: 56.25%;">
                    <img src="${video.thumbnail}" alt="${video.title}" class="absolute inset-0 w-full h-full object-cover">
                    <div class="absolute inset-0 flex items-center justify-center bg-black bg-opacity-40 hover:bg-opacity-20 transition-all duration-300">
                        <svg class="w-16 h-16 text-white" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"></path>
                        </svg>
                    </div>
                </div>
                <div class="p-4">
                    <h3 class="text-lg font-semibold leading-tight">${video.title}</h3>
                </div>
                ${isWatched ? `
                    <div class="absolute top-2 right-2 text-green-500 bg-gray-900 rounded-full p-1 shadow-lg">
                        <!-- Ícone de checkmark (visto) -->
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
                        </svg>
                    </div>
                ` : ''}
            `;
            videoCard.addEventListener('click', () => openVideoModal(video));
            return videoCard;
        };

        // Função para renderizar as seções de categorias
        const renderCategories = () => {
            videoCategoriesContainer.innerHTML = '';
            // Obtém categorias únicas, mantendo a ordem original da primeira ocorrência
            const uniqueCategories = new Set(videos.map(video => video.category));
            
            // Cria os botões de categoria dinamicamente, removendo os antigos
            const existingButtons = categoryButtonsContainer.querySelectorAll('.categoryBtn:not([data-category="Todos"]):not([data-category="Não Assistidos"])');
            existingButtons.forEach(button => button.remove());
            
            uniqueCategories.forEach(category => {
                const button = document.createElement('button');
                button.className = 'categoryBtn px-6 py-3 bg-gray-700 hover:bg-red-600 transition-colors text-lg rounded-full shadow-lg';
                button.dataset.category = category;
                button.textContent = category;
                categoryButtonsContainer.appendChild(button);
            });

            // Adiciona evento de clique para os botões de categoria
            document.querySelectorAll('.categoryBtn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const category = e.target.dataset.category;
                    
                    document.querySelectorAll('.categoryBtn').forEach(btn => btn.classList.remove('bg-red-600'));
                    e.target.classList.add('bg-red-600');

                    searchInput.value = '';
                    searchResultsSection.classList.add('hidden');
                    noResults.classList.add('hidden');

                    if (category === 'Todos') {
                        document.querySelectorAll('.video-category-section').forEach(section => section.classList.remove('hidden'));
                    } else if (category === 'Não Assistidos') {
                        document.querySelectorAll('.video-category-section').forEach(section => section.classList.add('hidden'));
                        const unwatchedVideos = videos.filter(video => !watchedVideos.has(video.id));
                        searchResultsGrid.innerHTML = '';
                        if (unwatchedVideos.length > 0) {
                            unwatchedVideos.forEach(video => {
                                searchResultsGrid.appendChild(createVideoCard(video));
                            });
                            searchResultsSection.classList.remove('hidden');
                        } else {
                            noResults.classList.remove('hidden');
                            noResults.textContent = 'Parabéns, você assistiu a todos os vídeos!';
                        }
                    } else {
                        document.querySelectorAll('.video-category-section').forEach(section => section.classList.add('hidden'));
                        const sectionToShow = document.getElementById(`category-${category.replace(/\s/g, '-')}`);
                        if (sectionToShow) {
                            sectionToShow.classList.remove('hidden');
                        }
                    }
                });
            });

            uniqueCategories.forEach(category => {
                const categorySection = document.createElement('section');
                categorySection.id = `category-${category.replace(/\s/g, '-')}`;
                categorySection.className = 'video-category-section mb-8';

                const sectionTitle = document.createElement('h2');
                sectionTitle.className = 'text-3xl font-bold mb-4';
                sectionTitle.textContent = category;
                categorySection.appendChild(sectionTitle);

                const horizontalContainer = document.createElement('div');
                horizontalContainer.className = 'horizontal-scroll-container flex space-x-6 overflow-x-auto pb-4';
                
                const categoryVideos = videos.filter(video => video.category === category);
                categoryVideos.forEach(video => {
                    horizontalContainer.appendChild(createVideoCard(video));
                });
                categorySection.appendChild(horizontalContainer);
                videoCategoriesContainer.appendChild(categorySection);
            });
        };
        
        // Função para abrir o modal do vídeo
        const openVideoModal = (video) => {
            // Se o mini-player estiver ativo, feche-o primeiro
            if (!miniPlayer.classList.contains('hidden')) {
                closeMiniPlayer();
            }
            videoContainer.innerHTML = `
                <iframe 
                    id="currentVideoIframe"
                    class="absolute top-0 left-0 w-full h-full rounded-lg"
                    src="https://www.youtube.com/embed/${video.id}?autoplay=1" 
                    frameborder="0" 
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                    allowfullscreen>
                </iframe>
            `;
            videoTitle.textContent = video.title;
            videoModal.classList.remove('hidden');
            
            // Adiciona a nova mensagem de rotação
            if (window.innerWidth < window.innerHeight) { // Verifica se a tela está em modo retrato
                rotateMessage.classList.remove('hidden');
                phoneRotateIcon.classList.add('animate-rotate');
                
                // Esconde a mensagem após 5 segundos
                setTimeout(() => {
                    rotateMessage.classList.add('hidden');
                    phoneRotateIcon.classList.remove('animate-rotate');
                }, 5000);
            }

            // Inicia o temporizador para marcar o vídeo como assistido
            watchTimer = setTimeout(() => {
                markVideoAsWatched(video.id);
            }, WATCH_THRESHOLD);
        };

        // Função para fechar o modal e mover o vídeo para o mini-player
        const closeModal = () => {
            videoModal.classList.add('hidden');
            // Obtém o iframe do vídeo
            const iframe = document.getElementById('currentVideoIframe');
            if (iframe) {
                // Adiciona o iframe ao mini-player
                miniPlayerVideoContainer.appendChild(iframe);
                // Exibe o mini-player
                miniPlayer.classList.remove('hidden');
                
                // Sai do modo de tela cheia se estiver ativo
                if (document.fullscreenElement) {
                    document.exitFullscreen();
                }
            }
            // Cancela o temporizador se o modal for fechado
            clearTimeout(watchTimer);
        };
        
        // Função para fechar o mini-player
        const closeMiniPlayer = () => {
            miniPlayer.classList.add('hidden');
            miniPlayerVideoContainer.innerHTML = ''; // Para o vídeo
            // Sai do modo de tela cheia se estiver ativo
            if (document.fullscreenElement) {
                document.exitFullscreen();
            }
        };

        // Adiciona evento de clique para o botão de fechar o modal grande
        closeModalBtn.addEventListener('click', closeModal);
        
        // Adiciona evento de clique para o botão de fechar o mini-player
        closeMiniPlayerBtn.addEventListener('click', closeMiniPlayer);

        // --- Lógica de arrastar o mini-player - Corrigida ---
        let isDragging = false;
        let initialX, initialY; // Posição inicial do clique do mouse/toque
        let xOffset = 0, yOffset = 0; // Posição atual do mini-player
        let animationFrameId = null;

        // Inicia o arrasto
        dragOverlay.addEventListener("mousedown", dragStart);
        dragOverlay.addEventListener("touchstart", dragStart);

        function dragStart(e) {
            e.preventDefault();
            // Se o clique for no botão de fechar, ignora o arrasto
            if (e.target === closeMiniPlayerBtn) return;
            
            const clientX = e.type === "touchstart" ? e.touches[0].clientX : e.clientX;
            const clientY = e.type === "touchstart" ? e.touches[0].clientY : e.clientY;

            // Armazena a posição inicial do mouse e do mini-player
            initialX = clientX;
            initialY = clientY;
            const style = window.getComputedStyle(miniPlayer);
            const matrix = new DOMMatrix(style.transform);
            xOffset = matrix.m41;
            yOffset = matrix.m42;

            isDragging = true;
            
            // Inicia o loop de animação
            animationFrameId = requestAnimationFrame(updatePosition);
        }

        // Finaliza o arrasto
        document.addEventListener("mouseup", dragEnd);
        document.addEventListener("touchend", dragEnd);

        function dragEnd(e) {
            isDragging = false;
            // Cancela o loop de animação
            cancelAnimationFrame(animationFrameId);
        }

        // Move o player com base na posição do mouse
        document.addEventListener("mousemove", dragMove);
        document.addEventListener("touchmove", dragMove);
        
        let currentX, currentY; // Posição atual do mouse/toque

        function dragMove(e) {
            if (!isDragging) return;
            e.preventDefault();

            currentX = e.type === "touchmove" ? e.touches[0].clientX : e.clientX;
            currentY = e.type === "touchmove" ? e.touches[0].clientY : e.clientY;
        }

        // Função de atualização no loop de animação
        function updatePosition() {
            if (isDragging) {
                const dx = currentX - initialX;
                const dy = currentY - initialY;
                
                let newX = xOffset + dx;
                let newY = yOffset + dy;

                // Limita a posição para que o player não saia da tela
                const screenWidth = window.innerWidth;
                const screenHeight = window.innerHeight;
                const playerWidth = miniPlayer.offsetWidth;
                const playerHeight = miniPlayer.offsetHeight;

                const minX = -screenWidth + playerWidth; // Permite arrastar para a esquerda
                const minY = -screenHeight + playerHeight; // Permite arrastar para cima

                newX = Math.min(Math.max(newX, minX), screenWidth);
                newY = Math.min(Math.max(newY, minY), screenHeight);

                setTranslate(newX, newY, miniPlayer);

                // Continua o loop
                animationFrameId = requestAnimationFrame(updatePosition);
            }
        }
        
        function setTranslate(xPos, yPos, el) {
            el.style.transform = `translate3d(${xPos}px, ${yPos}px, 0)`;
        }

        // Fecha o modal ao clicar fora dele
        window.addEventListener('click', (event) => {
            if (event.target === videoModal) {
                closeModal();
            }
        });

        // Função para filtrar os vídeos por texto de pesquisa
        const searchVideos = () => {
            const query = searchInput.value.toLowerCase();
            if (query.length > 0) {
                document.querySelectorAll('.video-category-section').forEach(section => section.classList.add('hidden'));
                
                const filteredVideos = videos.filter(video => 
                    video.title.toLowerCase().includes(query) || 
                    video.category.toLowerCase().includes(query)
                );
                
                searchResultsGrid.innerHTML = '';
                if (filteredVideos.length > 0) {
                    filteredVideos.forEach(video => {
                        searchResultsGrid.appendChild(createVideoCard(video));
                    });
                    searchResultsSection.classList.remove('hidden');
                    noResults.classList.add('hidden');
                } else {
                    searchResultsSection.classList.add('hidden');
                    noResults.classList.remove('hidden');
                    noResults.textContent = 'Nenhum vídeo encontrado com os termos da pesquisa.';
                }

                document.querySelectorAll('.categoryBtn').forEach(btn => btn.classList.remove('bg-red-600'));
            } else {
                document.querySelectorAll('.video-category-section').forEach(section => section.classList.remove('hidden'));
                searchResultsSection.classList.add('hidden');
                noResults.classList.add('hidden');

                const allBtn = document.querySelector('[data-category="Todos"]');
                if (allBtn) {
                    allBtn.classList.add('bg-red-600');
                }
            }
        };

        // Adiciona evento de "input" para a pesquisa em tempo real
        searchInput.addEventListener('input', searchVideos);

        // Renderiza as seções de categorias e ativa o botão "Todos" inicialmente
        window.onload = () => {
            loadWatchedVideos();
            renderCategories();
            const allBtn = document.querySelector('[data-category="Todos"]');
            if (allBtn) {
                allBtn.classList.add('bg-red-600');
            }
        };
    </script>
</body>
</html>
